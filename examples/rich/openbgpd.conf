# built by ARouteServer
AS 999
router-id 192.0.2.2

fib-update no
log updates

nexthop qualify via default

# ---------------------------------------------------------
# IRRDB

# AS10745
AS_SET_AS10745_asns="{ 10745 }"
AS_SET_AS10745_prefixes="{ 192.136.136.0/24, 192.149.252.0/24, 199.43.0.0/24, 2001:500:4::/48, 2001:500:30::/48, 2001:500:110::/48 }"

# AS3333
AS_SET_AS3333_asns="{ 3333 }"
AS_SET_AS3333_prefixes="{ 193.0.0.0/21, 193.0.10.0/23, 193.0.12.0/23, 193.0.18.0/23, 193.0.20.0/22 prefixlen 23 - 23, 2001:67c:2e8::/48 }"




# ---------------------------------------------------------
# MEMBERS

group "clients" {

	neighbor 192.0.2.11 {
		softreconfig in yes
		remote-as 3333
		passive
		ttl-security yes
		max-prefix 20 restart 30
		transparent-as yes
		enforce neighbor-as no

		announce all
		announce as-4byte yes
		announce IPv6 none
		announce IPv4 unicast

		set nexthop no-modify
	}

	neighbor 192.0.2.22 {
		softreconfig in yes
		remote-as 10745
		passive
		ttl-security yes
		max-prefix 5 restart 30
		transparent-as yes
		enforce neighbor-as no

		announce all
		announce as-4byte yes
		announce IPv6 none
		announce IPv4 unicast

		set nexthop no-modify
	}

	neighbor 2001:db:1:1::22 {
		softreconfig in yes
		remote-as 10745
		passive
		ttl-security yes
		max-prefix 12000 restart 30
		transparent-as yes
		enforce neighbor-as no

		announce all
		announce as-4byte yes
		announce IPv6 unicast
		announce IPv4 none

		set nexthop no-modify
	}
}



# ---------------------------------------------------------
# FILTERS

# NO_ADVERTISE usage notes.
# The NO_ADVERTISE well-know community is used here to handle
# filters that span over multiple steps. At first it is added
# to any route, then it is removed as filters conditions are
# satisfied. Finally, if it is still present, it means that
# the route should be discarded.




global_black_list_pref="{ 192.0.2.0/24 prefixlen 24 - 32, 2001:db8:1:1::/64 prefixlen 64 - 128 }"

bogons="{ 0.0.0.0/0, 0.0.0.0/8 prefixlen 8 - 32, 10.0.0.0/8 prefixlen 8 - 32, 127.0.0.0/8 prefixlen 8 - 32, 169.254.0.0/16 prefixlen 16 - 32, 172.16.0.0/12 prefixlen 12 - 32, 192.0.2.0/24 prefixlen 24 - 32, 192.168.0.0/16 prefixlen 16 - 32, 198.18.0.0/15 prefixlen 15 - 32, 198.51.100.0/24 prefixlen 24 - 32, 203.0.113.0/24 prefixlen 24 - 32, 224.0.0.0/3 prefixlen 3 - 32, 100.64.0.0/10 prefixlen 10 - 32, ::/0, ::/8 prefixlen 8 - 128, 64:ff9b::/96 prefixlen 96 - 128, 100::/8 prefixlen 8 - 128, 200::/7 prefixlen 7 - 128, 400::/6 prefixlen 6 - 128, 800::/5 prefixlen 5 - 128, 1000::/4 prefixlen 4 - 128, 2001::/33 prefixlen 33 - 128, 2001:0:8000::/33 prefixlen 33 - 128, 2001:2::/48 prefixlen 48 - 128, 2001:3::/32 prefixlen 32 - 128, 2001:10::/28 prefixlen 28 - 128, 2001:20::/28 prefixlen 28 - 128, 2001:db8::/32 prefixlen 32 - 128, 2002::/16 prefixlen 16 - 128, 3ffe::/16 prefixlen 16 - 128, 4000::/3 prefixlen 3 - 128, 5f00::/8 prefixlen 8 - 128, 6000::/3 prefixlen 3 - 128, 8000::/3 prefixlen 3 - 128, a000::/3 prefixlen 3 - 128, c000::/3 prefixlen 3 - 128, e000::/4 prefixlen 4 - 128, f000::/5 prefixlen 5 - 128, f800::/6 prefixlen 6 - 128, fc00::/7 prefixlen 7 - 128, fe80::/10 prefixlen 10 - 128, fec0::/10 prefixlen 10 - 128, ff00::/8 prefixlen 8 - 128 }"

transit_free_asns="{ 174, 209, 286, 701, 1239, 1299, 2828, 2914, 3257, 3320, 3356, 3549, 5511, 6453, 6461, 6762, 6830, 7018, 12956 }"

# Scrub communities from inbound routes
# origin_present_in_as_set
match from group clients set community delete 65530:1
match from group clients set large-community delete 999:65530:1
# origin_not_present_in_as_set
match from group clients set community delete 65530:0
match from group clients set large-community delete 999:65530:0
# from_usa
match from group clients set community delete 65534:2
match from group clients set ext-community delete rt 65534:2
match from group clients set large-community delete 999:65534:2
# from_europe
match from group clients set community delete 65534:1
match from group clients set ext-community delete rt 65534:1
match from group clients set large-community delete 999:65534:1


# AS_PATH: length
deny quick from group clients max-as-len 32


# Prefix: global blacklist
deny quick from group clients prefix $global_black_list_pref


# Prefix: only IPv6 Global Unicast space allowed
match from group clients inet6 set community NO_ADVERTISE
match from group clients prefix 2000::/3 or-longer set community delete NO_ADVERTISE
deny quick from group clients community NO_ADVERTISE


# Prefix: bogon
deny quick from group clients prefix $bogons



# ---------------------------------------------
# client AS3333_1, inbound


deny quick from 192.0.2.11 inet6


# Attach custom BGP communities
# from_europe
match from 192.0.2.11 set community 65534:1
match from 192.0.2.11 set ext-community rt 65534:1
match from 192.0.2.11 set large-community 999:65534:1

# NEXT_HOP
match from 192.0.2.11 set community NO_ADVERTISE
match from 192.0.2.11 nexthop 192.0.2.11 set community delete NO_ADVERTISE
deny quick from 192.0.2.11 community NO_ADVERTISE


# AS_PATH: left-most ASN
deny quick from 192.0.2.11 peer-as != 3333


# AS_PATH: invalid ASNs
deny quick from 192.0.2.11 AS 0

deny quick from 192.0.2.11 AS 23456

deny quick from 192.0.2.11 AS 64496 - 64511

deny quick from 192.0.2.11 AS 64512 - 65534

deny quick from 192.0.2.11 AS 65535


deny quick from 192.0.2.11 AS 65536 - 65551

deny quick from 192.0.2.11 AS 65552 - 131071

deny quick from 192.0.2.11 AS 4200000000 - 4294967294

deny quick from 192.0.2.11 AS 4294967295


# AS_PATH: transit-free ASNs
deny quick from 192.0.2.11 AS $transit_free_asns


# AS_PATH: enforce/tag origin via AS-SET
# enforcing: tag any with NO_ADVERTISE; it will be removed later if at least one AS-SET authorizes this route
match from 192.0.2.11 set community NO_ADVERTISE
# tag with not_present_in_as_set
match from 192.0.2.11 set community 65530:0
match from 192.0.2.11 set large-community 999:65530:0
# verifying if route is authorized by AS-SETs
match from 192.0.2.11 source-as $AS_SET_AS3333_asns set community delete NO_ADVERTISE	# AS3333
# removing not_present_in_as_set community from matching routes
match from 192.0.2.11 source-as $AS_SET_AS3333_asns set community delete 65530:0
match from 192.0.2.11 source-as $AS_SET_AS3333_asns set large-community delete 999:65530:0
# adding present_in_as_set community to matching routes
match from 192.0.2.11 source-as $AS_SET_AS3333_asns set community 65530:1
match from 192.0.2.11 source-as $AS_SET_AS3333_asns set large-community 999:65530:1
# enforcing: if NO_ADVERTISE has not been removed then the route is not authorized
deny quick from 192.0.2.11 community NO_ADVERTISE


# Prefix: enforce/tag prefix via AS-SET
# enforcing: tag any with NO_ADVERTISE; it will be removed later if at least one AS-SET authorizes this route
match from 192.0.2.11 set community NO_ADVERTISE
# verifying if route is authorized by AS-SETs
match from 192.0.2.11 prefix $AS_SET_AS3333_prefixes set community delete NO_ADVERTISE	# AS3333
# enforcing: if NO_ADVERTISE has not been removed then the route is not authorized
deny quick from 192.0.2.11 community NO_ADVERTISE

# Blackhole request?

allow quick from 192.0.2.11 community BLACKHOLE
allow quick from 192.0.2.11 community 65534:0 
allow quick from 192.0.2.11 large-community 999:666:0 



# Prefix: length
deny quick from 192.0.2.11 prefix 0.0.0.0/0 prefixlen 8 >< 24



allow quick from 192.0.2.11

# ---------------------------------------------
# client AS3333_1, outbound


# Blackhole request?
# Configured policy: rewrite-next-hop
match to 192.0.2.11 community 65534:0 set community BLACKHOLE
match to 192.0.2.11 large-community 999:666:0 set community BLACKHOLE
match to 192.0.2.11 community BLACKHOLE set community NO_EXPORT
match to 192.0.2.11 community BLACKHOLE set nexthop 192.0.2.66


# NO_EXPORT and NO_ADVERTISE communities
# add_noexport_to_any
match to 192.0.2.11 community 65507:999 set community NO_EXPORT
match to 192.0.2.11 ext-community rt 65507:999 set community NO_EXPORT
match to 192.0.2.11 large-community 999:65507:999 set community NO_EXPORT
# add_noadvertise_to_any
match to 192.0.2.11 community 65508:999 set community NO_ADVERTISE
match to 192.0.2.11 ext-community rt 65508:999 set community NO_ADVERTISE
match to 192.0.2.11 large-community 999:65508:999 set community NO_ADVERTISE
# add_noexport_to_peer
match to 192.0.2.11 community 65509:3333 set community NO_EXPORT
match to 192.0.2.11 ext-community rt 65509:3333 set community NO_EXPORT
match to 192.0.2.11 large-community 999:65509:3333 set community NO_EXPORT
# add_noadvertise_to_peer
match to 192.0.2.11 community 65510:3333 set community NO_ADVERTISE
match to 192.0.2.11 ext-community rt 65510:3333 set community NO_ADVERTISE
match to 192.0.2.11 large-community 999:65510:3333 set community NO_ADVERTISE

# BGP control communities
allow to 192.0.2.11

# do_not_announce_to_any
deny to 192.0.2.11 community 0:999 
deny to 192.0.2.11 ext-community rt 0:999 
deny to 192.0.2.11 large-community 999:0:999 
# do_not_announce_to_peer
deny quick to 192.0.2.11 community 0:3333 
deny quick to 192.0.2.11 ext-community rt 0:3333 
deny quick to 192.0.2.11 large-community 999:0:3333 
# announce_to_peer
allow to 192.0.2.11 community 999:3333 
allow to 192.0.2.11 ext-community rt 999:3333 
allow to 192.0.2.11 large-community 999:999:3333 

# prepend_once_to_peer; remove further "prepend" communities from matching routes
match to 192.0.2.11 community 65504:3333 set prepend-neighbor 1
match to 192.0.2.11 ext-community rt 65504:3333 set prepend-neighbor 1
match to 192.0.2.11 large-community 999:65504:3333 set prepend-neighbor 1
match to 192.0.2.11 community 65504:3333 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }
match to 192.0.2.11 ext-community rt 65504:3333 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }
match to 192.0.2.11 large-community 999:65504:3333 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }

# prepend_twice_to_peer; remove further "prepend" communities from matching routes
match to 192.0.2.11 community 65505:3333 set prepend-neighbor 2
match to 192.0.2.11 ext-community rt 65505:3333 set prepend-neighbor 2
match to 192.0.2.11 large-community 999:65505:3333 set prepend-neighbor 2
match to 192.0.2.11 community 65505:3333 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }
match to 192.0.2.11 ext-community rt 65505:3333 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }
match to 192.0.2.11 large-community 999:65505:3333 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }

# prepend_thrice_to_peer; remove further "prepend" communities from matching routes
match to 192.0.2.11 community 65506:3333 set prepend-neighbor 3
match to 192.0.2.11 ext-community rt 65506:3333 set prepend-neighbor 3
match to 192.0.2.11 large-community 999:65506:3333 set prepend-neighbor 3
match to 192.0.2.11 community 65506:3333 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }
match to 192.0.2.11 ext-community rt 65506:3333 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }
match to 192.0.2.11 large-community 999:65506:3333 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }


# prepend_once_to_any; remove further "prepend" communities from matching routes
match to 192.0.2.11 community 65501:999 set prepend-neighbor 1
match to 192.0.2.11 ext-community rt 65501:999 set prepend-neighbor 1
match to 192.0.2.11 large-community 999:65501:999 set prepend-neighbor 1
match to 192.0.2.11 community 65501:999 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }
match to 192.0.2.11 ext-community rt 65501:999 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }
match to 192.0.2.11 large-community 999:65501:999 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }

# prepend_twice_to_any; remove further "prepend" communities from matching routes
match to 192.0.2.11 community 65502:999 set prepend-neighbor 2
match to 192.0.2.11 ext-community rt 65502:999 set prepend-neighbor 2
match to 192.0.2.11 large-community 999:65502:999 set prepend-neighbor 2
match to 192.0.2.11 community 65502:999 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }
match to 192.0.2.11 ext-community rt 65502:999 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }
match to 192.0.2.11 large-community 999:65502:999 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }

# prepend_thrice_to_any; remove further "prepend" communities from matching routes
match to 192.0.2.11 community 65503:999 set prepend-neighbor 3
match to 192.0.2.11 ext-community rt 65503:999 set prepend-neighbor 3
match to 192.0.2.11 large-community 999:65503:999 set prepend-neighbor 3
match to 192.0.2.11 community 65503:999 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }
match to 192.0.2.11 ext-community rt 65503:999 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }
match to 192.0.2.11 large-community 999:65503:999 set {  community delete 65505:3333 ext-community delete rt 65505:3333 large-community delete 999:65505:3333 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:3333 ext-community delete rt 65504:3333 large-community delete 999:65504:3333 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:3333 ext-community delete rt 65506:3333 large-community delete 999:65506:3333 }


# ---------------------------------------------
# client AS10745_1, inbound


deny quick from 192.0.2.22 inet6


# Attach custom BGP communities
# from_usa
match from 192.0.2.22 set community 65534:2
match from 192.0.2.22 set ext-community rt 65534:2
match from 192.0.2.22 set large-community 999:65534:2

# NEXT_HOP
match from 192.0.2.22 set community NO_ADVERTISE
match from 192.0.2.22 nexthop 192.0.2.22 set community delete NO_ADVERTISE
deny quick from 192.0.2.22 community NO_ADVERTISE


# AS_PATH: left-most ASN
deny quick from 192.0.2.22 peer-as != 10745


# AS_PATH: invalid ASNs
deny quick from 192.0.2.22 AS 0

deny quick from 192.0.2.22 AS 23456

deny quick from 192.0.2.22 AS 64496 - 64511

deny quick from 192.0.2.22 AS 64512 - 65534

deny quick from 192.0.2.22 AS 65535


deny quick from 192.0.2.22 AS 65536 - 65551

deny quick from 192.0.2.22 AS 65552 - 131071

deny quick from 192.0.2.22 AS 4200000000 - 4294967294

deny quick from 192.0.2.22 AS 4294967295


# AS_PATH: transit-free ASNs
deny quick from 192.0.2.22 AS $transit_free_asns


# AS_PATH: enforce/tag origin via AS-SET
# enforcing: tag any with NO_ADVERTISE; it will be removed later if at least one AS-SET authorizes this route
match from 192.0.2.22 set community NO_ADVERTISE
# tag with not_present_in_as_set
match from 192.0.2.22 set community 65530:0
match from 192.0.2.22 set large-community 999:65530:0
# verifying if route is authorized by AS-SETs
match from 192.0.2.22 source-as $AS_SET_AS10745_asns set community delete NO_ADVERTISE	# AS10745
# removing not_present_in_as_set community from matching routes
match from 192.0.2.22 source-as $AS_SET_AS10745_asns set community delete 65530:0
match from 192.0.2.22 source-as $AS_SET_AS10745_asns set large-community delete 999:65530:0
# adding present_in_as_set community to matching routes
match from 192.0.2.22 source-as $AS_SET_AS10745_asns set community 65530:1
match from 192.0.2.22 source-as $AS_SET_AS10745_asns set large-community 999:65530:1
# enforcing: if NO_ADVERTISE has not been removed then the route is not authorized
deny quick from 192.0.2.22 community NO_ADVERTISE


# Prefix: enforce/tag prefix via AS-SET
# enforcing: tag any with NO_ADVERTISE; it will be removed later if at least one AS-SET authorizes this route
match from 192.0.2.22 set community NO_ADVERTISE
# verifying if route is authorized by AS-SETs
match from 192.0.2.22 prefix $AS_SET_AS10745_prefixes set community delete NO_ADVERTISE	# AS10745
# enforcing: if NO_ADVERTISE has not been removed then the route is not authorized
deny quick from 192.0.2.22 community NO_ADVERTISE

# Blackhole request?

allow quick from 192.0.2.22 community BLACKHOLE
allow quick from 192.0.2.22 community 65534:0 
allow quick from 192.0.2.22 large-community 999:666:0 



# Prefix: length
deny quick from 192.0.2.22 prefix 0.0.0.0/0 prefixlen 8 >< 24



allow quick from 192.0.2.22

# ---------------------------------------------
# client AS10745_1, outbound


# Blackhole request?
# Configured policy: rewrite-next-hop
match to 192.0.2.22 community 65534:0 set community BLACKHOLE
match to 192.0.2.22 large-community 999:666:0 set community BLACKHOLE
match to 192.0.2.22 community BLACKHOLE set community NO_EXPORT
match to 192.0.2.22 community BLACKHOLE set nexthop 192.0.2.66


# NO_EXPORT and NO_ADVERTISE communities
# add_noexport_to_any
match to 192.0.2.22 community 65507:999 set community NO_EXPORT
match to 192.0.2.22 ext-community rt 65507:999 set community NO_EXPORT
match to 192.0.2.22 large-community 999:65507:999 set community NO_EXPORT
# add_noadvertise_to_any
match to 192.0.2.22 community 65508:999 set community NO_ADVERTISE
match to 192.0.2.22 ext-community rt 65508:999 set community NO_ADVERTISE
match to 192.0.2.22 large-community 999:65508:999 set community NO_ADVERTISE
# add_noexport_to_peer
match to 192.0.2.22 community 65509:10745 set community NO_EXPORT
match to 192.0.2.22 ext-community rt 65509:10745 set community NO_EXPORT
match to 192.0.2.22 large-community 999:65509:10745 set community NO_EXPORT
# add_noadvertise_to_peer
match to 192.0.2.22 community 65510:10745 set community NO_ADVERTISE
match to 192.0.2.22 ext-community rt 65510:10745 set community NO_ADVERTISE
match to 192.0.2.22 large-community 999:65510:10745 set community NO_ADVERTISE

# BGP control communities
allow to 192.0.2.22

# do_not_announce_to_any
deny to 192.0.2.22 community 0:999 
deny to 192.0.2.22 ext-community rt 0:999 
deny to 192.0.2.22 large-community 999:0:999 
# do_not_announce_to_peer
deny quick to 192.0.2.22 community 0:10745 
deny quick to 192.0.2.22 ext-community rt 0:10745 
deny quick to 192.0.2.22 large-community 999:0:10745 
# announce_to_peer
allow to 192.0.2.22 community 999:10745 
allow to 192.0.2.22 ext-community rt 999:10745 
allow to 192.0.2.22 large-community 999:999:10745 

# prepend_once_to_peer; remove further "prepend" communities from matching routes
match to 192.0.2.22 community 65504:10745 set prepend-neighbor 1
match to 192.0.2.22 ext-community rt 65504:10745 set prepend-neighbor 1
match to 192.0.2.22 large-community 999:65504:10745 set prepend-neighbor 1
match to 192.0.2.22 community 65504:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 192.0.2.22 ext-community rt 65504:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 192.0.2.22 large-community 999:65504:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }

# prepend_twice_to_peer; remove further "prepend" communities from matching routes
match to 192.0.2.22 community 65505:10745 set prepend-neighbor 2
match to 192.0.2.22 ext-community rt 65505:10745 set prepend-neighbor 2
match to 192.0.2.22 large-community 999:65505:10745 set prepend-neighbor 2
match to 192.0.2.22 community 65505:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 192.0.2.22 ext-community rt 65505:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 192.0.2.22 large-community 999:65505:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }

# prepend_thrice_to_peer; remove further "prepend" communities from matching routes
match to 192.0.2.22 community 65506:10745 set prepend-neighbor 3
match to 192.0.2.22 ext-community rt 65506:10745 set prepend-neighbor 3
match to 192.0.2.22 large-community 999:65506:10745 set prepend-neighbor 3
match to 192.0.2.22 community 65506:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 192.0.2.22 ext-community rt 65506:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 192.0.2.22 large-community 999:65506:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }


# prepend_once_to_any; remove further "prepend" communities from matching routes
match to 192.0.2.22 community 65501:999 set prepend-neighbor 1
match to 192.0.2.22 ext-community rt 65501:999 set prepend-neighbor 1
match to 192.0.2.22 large-community 999:65501:999 set prepend-neighbor 1
match to 192.0.2.22 community 65501:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 192.0.2.22 ext-community rt 65501:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 192.0.2.22 large-community 999:65501:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }

# prepend_twice_to_any; remove further "prepend" communities from matching routes
match to 192.0.2.22 community 65502:999 set prepend-neighbor 2
match to 192.0.2.22 ext-community rt 65502:999 set prepend-neighbor 2
match to 192.0.2.22 large-community 999:65502:999 set prepend-neighbor 2
match to 192.0.2.22 community 65502:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 192.0.2.22 ext-community rt 65502:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 192.0.2.22 large-community 999:65502:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }

# prepend_thrice_to_any; remove further "prepend" communities from matching routes
match to 192.0.2.22 community 65503:999 set prepend-neighbor 3
match to 192.0.2.22 ext-community rt 65503:999 set prepend-neighbor 3
match to 192.0.2.22 large-community 999:65503:999 set prepend-neighbor 3
match to 192.0.2.22 community 65503:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 192.0.2.22 ext-community rt 65503:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 192.0.2.22 large-community 999:65503:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }


# ---------------------------------------------
# client AS10745_2, inbound


deny quick from 2001:db:1:1::22 inet


# Attach custom BGP communities
# from_usa
match from 2001:db:1:1::22 set community 65534:2
match from 2001:db:1:1::22 set ext-community rt 65534:2
match from 2001:db:1:1::22 set large-community 999:65534:2

# NEXT_HOP
match from 2001:db:1:1::22 set community NO_ADVERTISE
match from 2001:db:1:1::22 nexthop 2001:db:1:1::22 set community delete NO_ADVERTISE
deny quick from 2001:db:1:1::22 community NO_ADVERTISE


# AS_PATH: left-most ASN
deny quick from 2001:db:1:1::22 peer-as != 10745


# AS_PATH: invalid ASNs
deny quick from 2001:db:1:1::22 AS 0

deny quick from 2001:db:1:1::22 AS 23456

deny quick from 2001:db:1:1::22 AS 64496 - 64511

deny quick from 2001:db:1:1::22 AS 64512 - 65534

deny quick from 2001:db:1:1::22 AS 65535


deny quick from 2001:db:1:1::22 AS 65536 - 65551

deny quick from 2001:db:1:1::22 AS 65552 - 131071

deny quick from 2001:db:1:1::22 AS 4200000000 - 4294967294

deny quick from 2001:db:1:1::22 AS 4294967295


# AS_PATH: transit-free ASNs
deny quick from 2001:db:1:1::22 AS $transit_free_asns


# AS_PATH: enforce/tag origin via AS-SET
# enforcing: tag any with NO_ADVERTISE; it will be removed later if at least one AS-SET authorizes this route
match from 2001:db:1:1::22 set community NO_ADVERTISE
# tag with not_present_in_as_set
match from 2001:db:1:1::22 set community 65530:0
match from 2001:db:1:1::22 set large-community 999:65530:0
# verifying if route is authorized by AS-SETs
match from 2001:db:1:1::22 source-as $AS_SET_AS10745_asns set community delete NO_ADVERTISE	# AS10745
# removing not_present_in_as_set community from matching routes
match from 2001:db:1:1::22 source-as $AS_SET_AS10745_asns set community delete 65530:0
match from 2001:db:1:1::22 source-as $AS_SET_AS10745_asns set large-community delete 999:65530:0
# adding present_in_as_set community to matching routes
match from 2001:db:1:1::22 source-as $AS_SET_AS10745_asns set community 65530:1
match from 2001:db:1:1::22 source-as $AS_SET_AS10745_asns set large-community 999:65530:1
# enforcing: if NO_ADVERTISE has not been removed then the route is not authorized
deny quick from 2001:db:1:1::22 community NO_ADVERTISE


# Prefix: enforce/tag prefix via AS-SET
# enforcing: tag any with NO_ADVERTISE; it will be removed later if at least one AS-SET authorizes this route
match from 2001:db:1:1::22 set community NO_ADVERTISE
# verifying if route is authorized by AS-SETs
match from 2001:db:1:1::22 prefix $AS_SET_AS10745_prefixes set community delete NO_ADVERTISE	# AS10745
# enforcing: if NO_ADVERTISE has not been removed then the route is not authorized
deny quick from 2001:db:1:1::22 community NO_ADVERTISE

# Blackhole request?

allow quick from 2001:db:1:1::22 community BLACKHOLE
allow quick from 2001:db:1:1::22 community 65534:0 
allow quick from 2001:db:1:1::22 large-community 999:666:0 



# Prefix: length
deny quick from 2001:db:1:1::22 prefix ::/0 prefixlen 12 >< 48



allow quick from 2001:db:1:1::22

# ---------------------------------------------
# client AS10745_2, outbound


# Blackhole request?
# Configured policy: rewrite-next-hop
match to 2001:db:1:1::22 community 65534:0 set community BLACKHOLE
match to 2001:db:1:1::22 large-community 999:666:0 set community BLACKHOLE
match to 2001:db:1:1::22 community BLACKHOLE set community NO_EXPORT
match to 2001:db:1:1::22 community BLACKHOLE set nexthop 2001:db8:1:1::66


# NO_EXPORT and NO_ADVERTISE communities
# add_noexport_to_any
match to 2001:db:1:1::22 community 65507:999 set community NO_EXPORT
match to 2001:db:1:1::22 ext-community rt 65507:999 set community NO_EXPORT
match to 2001:db:1:1::22 large-community 999:65507:999 set community NO_EXPORT
# add_noadvertise_to_any
match to 2001:db:1:1::22 community 65508:999 set community NO_ADVERTISE
match to 2001:db:1:1::22 ext-community rt 65508:999 set community NO_ADVERTISE
match to 2001:db:1:1::22 large-community 999:65508:999 set community NO_ADVERTISE
# add_noexport_to_peer
match to 2001:db:1:1::22 community 65509:10745 set community NO_EXPORT
match to 2001:db:1:1::22 ext-community rt 65509:10745 set community NO_EXPORT
match to 2001:db:1:1::22 large-community 999:65509:10745 set community NO_EXPORT
# add_noadvertise_to_peer
match to 2001:db:1:1::22 community 65510:10745 set community NO_ADVERTISE
match to 2001:db:1:1::22 ext-community rt 65510:10745 set community NO_ADVERTISE
match to 2001:db:1:1::22 large-community 999:65510:10745 set community NO_ADVERTISE

# BGP control communities
allow to 2001:db:1:1::22

# do_not_announce_to_any
deny to 2001:db:1:1::22 community 0:999 
deny to 2001:db:1:1::22 ext-community rt 0:999 
deny to 2001:db:1:1::22 large-community 999:0:999 
# do_not_announce_to_peer
deny quick to 2001:db:1:1::22 community 0:10745 
deny quick to 2001:db:1:1::22 ext-community rt 0:10745 
deny quick to 2001:db:1:1::22 large-community 999:0:10745 
# announce_to_peer
allow to 2001:db:1:1::22 community 999:10745 
allow to 2001:db:1:1::22 ext-community rt 999:10745 
allow to 2001:db:1:1::22 large-community 999:999:10745 

# prepend_once_to_peer; remove further "prepend" communities from matching routes
match to 2001:db:1:1::22 community 65504:10745 set prepend-neighbor 1
match to 2001:db:1:1::22 ext-community rt 65504:10745 set prepend-neighbor 1
match to 2001:db:1:1::22 large-community 999:65504:10745 set prepend-neighbor 1
match to 2001:db:1:1::22 community 65504:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 2001:db:1:1::22 ext-community rt 65504:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 2001:db:1:1::22 large-community 999:65504:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }

# prepend_twice_to_peer; remove further "prepend" communities from matching routes
match to 2001:db:1:1::22 community 65505:10745 set prepend-neighbor 2
match to 2001:db:1:1::22 ext-community rt 65505:10745 set prepend-neighbor 2
match to 2001:db:1:1::22 large-community 999:65505:10745 set prepend-neighbor 2
match to 2001:db:1:1::22 community 65505:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 2001:db:1:1::22 ext-community rt 65505:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 2001:db:1:1::22 large-community 999:65505:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }

# prepend_thrice_to_peer; remove further "prepend" communities from matching routes
match to 2001:db:1:1::22 community 65506:10745 set prepend-neighbor 3
match to 2001:db:1:1::22 ext-community rt 65506:10745 set prepend-neighbor 3
match to 2001:db:1:1::22 large-community 999:65506:10745 set prepend-neighbor 3
match to 2001:db:1:1::22 community 65506:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 2001:db:1:1::22 ext-community rt 65506:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 2001:db:1:1::22 large-community 999:65506:10745 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }


# prepend_once_to_any; remove further "prepend" communities from matching routes
match to 2001:db:1:1::22 community 65501:999 set prepend-neighbor 1
match to 2001:db:1:1::22 ext-community rt 65501:999 set prepend-neighbor 1
match to 2001:db:1:1::22 large-community 999:65501:999 set prepend-neighbor 1
match to 2001:db:1:1::22 community 65501:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 2001:db:1:1::22 ext-community rt 65501:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 2001:db:1:1::22 large-community 999:65501:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }

# prepend_twice_to_any; remove further "prepend" communities from matching routes
match to 2001:db:1:1::22 community 65502:999 set prepend-neighbor 2
match to 2001:db:1:1::22 ext-community rt 65502:999 set prepend-neighbor 2
match to 2001:db:1:1::22 large-community 999:65502:999 set prepend-neighbor 2
match to 2001:db:1:1::22 community 65502:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 2001:db:1:1::22 ext-community rt 65502:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 2001:db:1:1::22 large-community 999:65502:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }

# prepend_thrice_to_any; remove further "prepend" communities from matching routes
match to 2001:db:1:1::22 community 65503:999 set prepend-neighbor 3
match to 2001:db:1:1::22 ext-community rt 65503:999 set prepend-neighbor 3
match to 2001:db:1:1::22 large-community 999:65503:999 set prepend-neighbor 3
match to 2001:db:1:1::22 community 65503:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 2001:db:1:1::22 ext-community rt 65503:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }
match to 2001:db:1:1::22 large-community 999:65503:999 set {  community delete 65505:10745 ext-community delete rt 65505:10745 large-community delete 999:65505:10745 community delete 65501:999 ext-community delete rt 65501:999 large-community delete 999:65501:999 community delete 65502:999 ext-community delete rt 65502:999 large-community delete 999:65502:999 community delete 65504:10745 ext-community delete rt 65504:10745 large-community delete 999:65504:10745 community delete 65503:999 ext-community delete rt 65503:999 large-community delete 999:65503:999 community delete 65506:10745 ext-community delete rt 65506:10745 large-community delete 999:65506:10745 }


# Scrub communities from outbound routes
# blackholing
match to group clients set community delete 65534:0
match to group clients set large-community delete 999:666:0
# add_noexport_to_any
match to group clients set community delete 65507:999
match to group clients set ext-community delete rt 65507:999
match to group clients set large-community delete 999:65507:999
# add_noexport_to_peer
match to group clients set community delete 65509:*
# rt:65509:peer_as ext comm skipped: can't delete ext comms using wildcard
match to group clients set large-community delete 999:65509:*
# add_noadvertise_to_any
match to group clients set community delete 65508:999
match to group clients set ext-community delete rt 65508:999
match to group clients set large-community delete 999:65508:999
# prepend_twice_to_peer
match to group clients set community delete 65505:*
# rt:65505:peer_as ext comm skipped: can't delete ext comms using wildcard
match to group clients set large-community delete 999:65505:*
# add_noadvertise_to_peer
match to group clients set community delete 65510:*
# rt:65510:peer_as ext comm skipped: can't delete ext comms using wildcard
match to group clients set large-community delete 999:65510:*
# prepend_once_to_any
match to group clients set community delete 65501:999
match to group clients set ext-community delete rt 65501:999
match to group clients set large-community delete 999:65501:999
# prepend_twice_to_any
match to group clients set community delete 65502:999
match to group clients set ext-community delete rt 65502:999
match to group clients set large-community delete 999:65502:999
# announce_to_peer
match to group clients set community delete 999:*
# rt:999:peer_as ext comm skipped: can't delete ext comms using wildcard
match to group clients set large-community delete 999:999:*
# prepend_once_to_peer
match to group clients set community delete 65504:*
# rt:65504:peer_as ext comm skipped: can't delete ext comms using wildcard
match to group clients set large-community delete 999:65504:*
# prepend_thrice_to_any
match to group clients set community delete 65503:999
match to group clients set ext-community delete rt 65503:999
match to group clients set large-community delete 999:65503:999
# do_not_announce_to_peer
match to group clients set community delete 0:*
# rt:0:peer_as ext comm skipped: can't delete ext comms using wildcard
match to group clients set large-community delete 999:0:*
# prepend_thrice_to_peer
match to group clients set community delete 65506:*
# rt:65506:peer_as ext comm skipped: can't delete ext comms using wildcard
match to group clients set large-community delete 999:65506:*
# do_not_announce_to_any
match to group clients set community delete 0:999
match to group clients set ext-community delete rt 0:999
match to group clients set large-community delete 999:0:999


